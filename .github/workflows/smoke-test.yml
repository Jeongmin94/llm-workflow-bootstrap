name: smoke-test

on:
  push:
    branches: [main]
  pull_request:

jobs:
  bootstrap-smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Lint shell syntax
        run: bash -n scripts/bootstrap-workflow.sh

      - name: Run bootstrap smoke test
        run: |
          set -euo pipefail
          TARGET_DIR="$(mktemp -d)"
          bash scripts/bootstrap-workflow.sh \
            --target "$TARGET_DIR" \
            --project-name "CI Smoke" \
            --issue-prefix CI \
            --models codex,claude,gemini

          test -f "$TARGET_DIR/AGENTS.md"
          test -f "$TARGET_DIR/docs/workflows/apply-common.md"
          test -f "$TARGET_DIR/.codex/skills/codex-apply/SKILL.md"
          test -f "$TARGET_DIR/.claude/skills/claude-apply/SKILL.md"
          test -f "$TARGET_DIR/.agent/skills/gemini-apply/SKILL.md"
          test -f "$TARGET_DIR/.agent-stack/skills/apply-common.md"
          test -f "$TARGET_DIR/docs/mcp/notion.md"
